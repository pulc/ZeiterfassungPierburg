@model ZeiterfassungPierburg.Models.ViewModels.Dashboard

@if (Convert.ToInt32(Session["AccessLayer"]) == null || Convert.ToInt32(Session["AccessLayer"]) == 0)
{
    Layout = "~/Views/Shared/_LayoutPublic.cshtml";
}

<link href="~/Content/Chart.css" rel="stylesheet" />

<!-- Content Header (Page header) -->
<section class="content-header">

    <fieldset>

        @if (Session["UserName"] != null)
        {<text>
                <h1>  Herzlich willkommen @Session["UserName"].ToString()!</h1></text>
    }
    </fieldset>


</section>
<section class="content">

    <!-- Small boxes (Stat box) -->
    <div class="row">

        <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-aqua">
                <div class="inner">
                    <h3>
                        @ViewBag.MitarbeiterAnzahl
                    </h3>
                    <p>Mitarbeiter</p>
                </div>
                <div class="icon">
                    <i class="ion ion-bag"></i>
                </div>
                <a href="~/Mitarbeiter/Index" class="small-box-footer">zur Tabelle gehen <i class="fa fa-arrow-circle-right"></i></a>
            </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-green">
                <div class="inner">
                    <h3>
                        @ViewBag.Produktionsanlagen
                    </h3>
                    <p>Produktionsanlagen</p>
                </div>
                <div class="icon">
                    <i class="ion ion-stats-bars"></i>
                </div>
                <a href="~/Produktionsanlage/Index" class="small-box-footer">zur Tabelle gehen <i class="fa fa-arrow-circle-right"></i></a>
            </div>
        </div>

        <!-- ./col -->
        <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-yellow">
                <div class="inner">
                    <h3>
                        @ViewBag.Fertigungsteile
                    </h3>

                    <p>Fertigungsteile</p>
                </div>
                <div class="icon">
                    <i class="ion ion-person-add"></i>
                </div>
                <a href="~/Fertigungsteil/Index" class="small-box-footer">zur Tabelle gehen <i class="fa fa-arrow-circle-right"></i></a>
            </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-red">
                <div class="inner">
                    <h3> @ViewBag.Zeiterfassungen</h3>

                    <p>Zeiterfassungen</p>
                </div>
                <div class="icon">
                    <i class="ion ion-pie-graph"></i>
                </div>
                <a href="~/MitarbeiterInSchicht/Index" class="small-box-footer">zur Tabelle gehen <i class="fa fa-arrow-circle-right"></i></a>
            </div>
        </div>

        <div class="col-lg-3 col-xs-6">
            <div class="box-footer text-black">
                <h4 style="padding-bottom: 20px;">Produktivität im letzten Monat - Bänder</h4>
                <div class="row">
                    <div class="col-sm-12">
                        <!-- Progress bars -->
                        <div class="clearfix">
                            <div id="productivity"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="box-footer text-black">

                <h4 style="padding-bottom: 20px;">Produktivität im letzten Monat - Maschinen</h4>

                <div class="row">
                    <div class="col-sm-12">
                        <!-- Progress bars -->
                        <div class="clearfix">
                            <div id="productivityMaschinen"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="col-lg-6 col-xs-6">

            <div class="box-footer text-black">
                <h4>Produktivität der letzten 12 Monate</h4>

                <canvas id="bar-chart" width="700" height="330"></canvas>
            </div>
        </div>




        <div class="col-lg-3 col-xs-6" id="stückFrame">
            <div class="box-footer text-black">
                <h4>Statistik der Stücke:</h4>

                <div class="row">
                    <div class="col-sm-12">
                        <div class="clearfix">
                            <span>letzte Woche gesamt: <h3> @ViewBag.StückeWoche </h3></span>
                            <hr />
                        </div>
                        <div class="col-sm-12">
                            <div class="clearfix">
                                <h5><span id="day0"></span><span class="pull-right"><span class="label label-warning"> @ViewBag.StückeToday </span></span></h5>
                            </div>
                            <div class="clearfix">
                                <h5><span id="day1"></span><span class="pull-right"><span class="label label-warning"> @ViewBag.StückeMinusOneDay </span></span></h5>
                            </div>
                            <div class="clearfix">
                                <h5><span id="day2"></span><span class="pull-right"><span class="label label-warning"> @ViewBag.StückeMinusTwoDays </span></span></h5>
                            </div>
                            <div class="clearfix">
                                <h5><span id="day3"></span><span class="pull-right"><span class="label label-warning"> @ViewBag.StückeMinusThreeDays</span> </span></h5>
                            </div>
                            <div class="clearfix">
                                <h5><span id="day4"></span> <span class="pull-right"><span class="label label-warning"> @ViewBag.StückeMinusFourDays </span></span></h5>
                            </div>
                            <div class="clearfix">
                                <h5><span id="day5"></span><span class="pull-right"> <span class="label label-warning"> @ViewBag.StückeMinusFiveDays </span></span></h5>
                            </div>
                            <div class="clearfix">
                                <h5><span id="day6"></span><span class="pull-right"> <span class="label label-warning"> @ViewBag.StückeMinusSixDays</span> </span></h5>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-9 col-xs-9">


            <div class="box-footer text-black">
                <h4>Placeholder for Pronom</h4>

                <div class="row">
                    <iframe src="https://de.wikipedia.org/wiki/Rheinmetall_Automotive" width="100%" height="400" name="SELFHTML_in_a_box"></iframe>
                </div>
            </div>
        </div>
    </div>



    <!-- ./col -->
    <!-- ./col -->






</section>

@section scripts{

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="~/Scripts/Chart.js"></script>




    <script>

        var monthsDictionary = @Html.Raw(Json.Encode(ViewBag.ProduktivitätLast12Months));

        var months = [];
        var values = [];

        for (var key in monthsDictionary) {
            months.push(key)
            values.push(monthsDictionary[key]);
        }
        new Chart(document.getElementById("bar-chart"), {
            type: 'bar',
            data: {
                labels: months,
                datasets: [
                    {
                        label: "Produktivität (Prozent)",
                        backgroundColor:[
                            'rgba(128, 0, 0, 0.2)',
                            'rgba(170, 110, 40, 0.2)',
                            'rgba(230, 25, 75, 0.2)',
                            'rgba(255, 225, 25, 0.2)',
                            'rgba(60, 180, 75, 0.2)',
                            'rgba(0, 128, 128, 0.2)',
                            'rgba(70, 240, 240, 0.2)',
                            'rgba(13, 102, 55, 0.2)',
                            'rgba(0, 0, 128, 0.2)',
                            'rgba(0, 130, 200, 0.2)',
                            'rgba(240, 50, 230, 0.2)',
                            'rgba(0, 0, 0, 0.2)'
                        ],
                        data: values
                    }
                ]
            },
            options: {
                legend: { display: false },
                title: {
                    display: true,
                    text: 'Die Produktivität an allen Bändern in jeweiligen Monaten'
                }
            }
        });

        $(document).ready(function () {

            var weekday = new Array(7);
            weekday[0] = "Sonntag";
            weekday[1] = "Montag";
            weekday[2] = "Dienstag";
            weekday[3] = "Mittwoch";
            weekday[4] = "Donnerstag";
            weekday[5] = "Freitag";
            weekday[6] = "Samstag";

        var i;
        for (i = 0; i < 7; i++) {

            n = new Date();
            n.setDate(n.getDate() - i);

            y = n.getFullYear();
            m = n.getMonth() + 1;
            d = n.getDate();


            var a = weekday[n.getDay()];

            document.getElementById("day"+i).innerHTML = a +", "+ d + "." + m + ".     ";
        }
        /*
            var dateString = "12/22/2017";
            var date1 = new Date(dateString);
            var daysPrior = 28;
            date1.setDate(date1.getDate() - daysPrior));
        print(date1.toISOString());
        */

            var html = '';
                            var dictionary = @Html.Raw(Json.Encode(ViewBag.ProduktivitätBerechnungProBandLastMonth));
                            for(var key in dictionary ){
                                var value = dictionary[key];


                                html = html+ ` <div class="clearfix">
                            <span class="pull-left">`+ key +`</span>
                            <small class="pull-right">`+ value +`%</small>
                        </div>
                        <div class="progress xs">
                            <div class="progress-bar progress-bar-green" style="width: `+ value +`%;"></div>
                        </div>`;
            }
            var p = document.getElementById("productivity");
            p.innerHTML = html;



            // Maschinen Produktivität Berechnung

            var htmlMaschinen = '';
                            var dictionaryMaschinen = @Html.Raw(Json.Encode(ViewBag.ProduktivitätBerechnungProMaschineLastMonth));
            for (var key in dictionaryMaschinen ){
                var value = dictionaryMaschinen[key];


                                htmlMaschinen = htmlMaschinen+ ` <div class="clearfix">
                            <span class="pull-left">`+ key +`</span>
                            <small class="pull-right">`+ value +`%</small>
                        </div>
                        <div class="progress xs">
                            <div class="progress-bar progress-bar-green" style="width: `+ value +`%;"></div>
                        </div>`;
            }
            var r = document.getElementById("productivityMaschinen");
            r.innerHTML = htmlMaschinen;


    });

    </script>
}
